//a start button initializes
//timer and first question
//first question has multiple choice
//if answer is correct then next question
//if answer is incorrect then next question and subtract time
//if all questions are answered or timer = 0, end game
//present quiz grade
//give opportunity to add initials to document score (did not complete, yet)

//Global Variables--list of global variables
//arrayIndex is the index of the array of objects question
let arrayIndex;
//indexArray is a new array populated by arrayIndexed already used in game
let indexArray = [];
//timer is a timer that counts down each second
let timer;
//the number of seconds timer starts with
let timeLeft = 10;
let score = 0;

//Interactions with the DOM
let answerA = document.getElementById("answerA");
let answerB = document.getElementById("answerB");
let answerC = document.getElementById("answerC");
let answerD = document.getElementById("answerD");
let actualScore = document.getElementById("actualScore");
let startGame = document.querySelector("#start");
let gameOver = document.getElementById('gameOver');
let yourScore = document.getElementById('yourScore');
let answers = document.querySelector("#answers");
let docDisplay = document.querySelector("#questionDisplay");
let timerDisplay = document.getElementById("timerDisplay")
startGame.addEventListener("click", jsChallenge);

//Functions
//Function to control some timer aspects
function clock() {
  //timerDisplay
  timerDisplay.innerHTML = timeLeft;
  timeLeft--;
  //if timeLeft is less than zero timer supposed to clear. a little buggy.
  if (timeLeft < 0) {
    clearInterval(timer);
  }
 };

 //function called by first click on "start" button
function jsChallenge() {
  //display none of start button upon click of start button
  startGame.style.display = 'none';
  //display answers on click of start button
  answers.style.display = 'flex';
  //display questionDisplay on click of start button
  questionDisplay.style.display = 'flex';
  //initiate timer counting down every 1000 ms.
  timer = setInterval(clock, 1000);
  //call a random index of array of objects Question
  arrayIndex = Math.floor(Math.random()*6);
  //push called index above into new array
  indexArray.push(arrayIndex);
  //call manageQuestions function
  manageQuestions();
  //call answersHandler function
  answersHandler();
};

//function displays quetions when arrayIndex generated by jsChallenge function
function manageQuestions() {
  docDisplay.innerHTML = questions[arrayIndex].question;
};

//function displays answers when arrayIndex generated and they all ar questions of the same index
function answersHandler() {
  answerA.innerText = questions[arrayIndex].answers.a;
  answerB.innerText = questions[arrayIndex].answers.b;
  answerC.innerText = questions[arrayIndex].answers.c;
  answerD.innerText = questions[arrayIndex].answers.d;
  //use event delegation so that if any of the above elements is clicked, generateIndex is called
  answers.onclick = generateIndex;
};

//function generateIndex called by answerHandler
function generateIndex(event) {
  //variable userAnswer is set to the innerText of the element clicked
  let userAnswer = event.target.innerText;
  //checks if text of userAnswer is the same as text of answer property of Questions array of objects with that index
  if (userAnswer === questions[arrayIndex].correctAnswer) {
    //if correct score increases by one
    score++;
    //if incorrect score decreases by 5 seconds.
  } else if (userAnswer !== questions[arrayIndex].correctAnswer) {
    timeLeft = timeLeft - 5;
  }
  //check to see if game exhausts questions by arrayIndex > questions.length then endQuiz() or timeLeft = 0. a little buggy.
  if (indexArray.length === questions.length || timeLeft <= 0) {
    endQuiz();
    return;
  }
  //create random arrayIndex
  arrayIndex = Math.floor(Math.random()*6);
  //while loop checks if indexArray includes an index and if not uses that index. If it has that index it chooses a new one.
  while (indexArray.includes(arrayIndex)) {
  arrayIndex = Math.floor(Math.random()*6);
 } 
 //repeat of last few lines of jsChallenge. Necessary to call recursively.
  indexArray.push(arrayIndex);
  manageQuestions();
  answersHandler();
};

//function called to endQuiz. certain elements displayed none and some displayed flex.
function endQuiz() {
   //end quiz function to display last page with stats.
  questionDisplay.style.display = 'none';
  answers.style.display = 'none';
  gameOver.style.display = 'flex';
  yourScore.style.display = 'flex';
  console.log(score);
  actualScore.innerHTML = " " + score;
  //stores current score of one game run in localstorage
  localStorage.setItem("score", score);
}

//Questions Array of Objects
const questions = [
  {
    question: "What can you do with JavaScript?",
    answers: {
      a: "a: change document text",
      b: "b: change text styles",
      c: "c: create website interactions",
      d: "d: all of the above",
    },
    correctAnswer: "d: all of the above",
  },
  {
    question: "What is the DOM?",
    answers: {
      a: "a: an API",
      b: "b: an html page",
      c: "c: a domain",
      d: "d: none of the above",
    },
    correctAnswer: "a: an API",
  },
  {
    question: "How do you access the DOM?",
    answers: {
      a: "a: using JavaScript",
      b: "b: using Python",
      c: "c: using html",
      d: "d: a and b",
    },
    correctAnswer: "d: a and b",
  },
  {
    question: "What is the BOM?",
    answers: {
      a: "a: another name for the DOM",
      b: "b: an important part of JavaScript",
      c: "c: an important part of ECMAScript",
      d: "d: b and c"
    },
    correctAnswer: "b: an important part of JavaScript",
  },
  {
    question: "What is ECMAScript?",
    answers: {
      a: "a: another name for JavaScript",
      b: "b: a standard maintained by ECMA International",
      c: "c: a scripting language",
      d: "d: b and c"
    },
    correctAnswer: "d: b and c",
  },
  {
    question: "What variable declarations are allowed in JavaScript?",
    answers: {
      a: "a: var",
      b: "b: const",
      c: "c: let",
      d: "d: a, b, and c"
    },
    correctAnswer: "d: a, b, and c"
  }
];